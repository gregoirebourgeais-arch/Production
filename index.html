<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Atelier PPNC</title>

  <!-- Feuille de style -->
  <link rel="stylesheet" href="style.css">

  <!-- Manifest PWA -->
  <link rel="manifest" href="manifest.json">
<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("service-worker.js");
  }
</script>

  <!-- Chart.js pour le graphique -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Librairie Excel -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <!-- Icône PWA -->
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
</head>
<body>
  <!-- DEBUG OVERLAY (affiche les erreurs JS, à retirer après tests) -->
  <div id="debug-overlay"
       style="position:fixed;top:0;left:0;right:0;z-index:99999;
       background:rgba(220,0,0,.9);color:#fff;font:12px/1.4 monospace;
       padding:6px;display:none"></div>
  <script>
    (function(){
      const box=document.getElementById('debug-overlay');
      function show(msg){
        box.style.display='block';
        box.innerHTML+=(box.innerHTML?'<br>':'')+msg;
      }
      window.addEventListener('error',e=>show('JS error: '+e.message+' @ '+(e.filename||'')+':'+(e.lineno||'')));
      window.addEventListener('unhandledrejection',e=>show('Promise rejection: '+(e.reason&&e.reason.message?e.reason.message:String(e.reason))));
    })();
  </script>

  <!-- HEADER -->
  <header class="header">
    <div class="header-left">
      <img src="logo-lactalis.png" alt="Logo" class="logo">
      <div class="header-title">
        <h1>Atelier PPNC</h1>
        <p id="dateDisplay"></p>
      </div>
    </div>
  </header>

  <!-- MENU PRINCIPAL -->
  <nav class="main-nav">
    <button onclick="openPage('atelier')">📊 Atelier</button>
    <button onclick="openPage('production')">📦 Production</button>
    <button onclick="openPage('arrets')">⏸️ Arrêts</button>
    <button onclick="openPage('organisation')">🗂️ Organisation</button>
    <button onclick="openPage('personnel')">👥 Personnel</button>
    <button onclick="exportExcel()">📈 Export Excel</button>
  </nav>

  <!-- SECTION ATELIER (page par défaut) -->
  <main id="atelier" class="page active">
    <h2>Vue d’ensemble de l’atelier</h2>

    <!-- GRAPH -->
    <div class="card">
      <canvas id="atelierChart" height="180"></canvas>
    </div>

    <!-- HISTORIQUE GLOBAL -->
    <section id="atelierHistorique" class="historique">
      <h3>Historique global</h3>
      <div id="historiqueContent"></div>
    </section>

    <!-- BOUTON CALCULATRICE -->
    <button id="calcToggle" class="floating-btn" onclick="toggleCalc()">🧮</button>

    <!-- CALCULATRICE -->
    <div id="calcContainer" class="calc hidden">
      <input type="text" id="calcInput" readonly>
      <div class="calc-grid">
        <button onclick="calcInput.value += '7'">7</button>
        <button onclick="calcInput.value += '8'">8</button>
        <button onclick="calcInput.value += '9'">9</button>
        <button onclick="calcInput.value += '/'">/</button>

        <button onclick="calcInput.value += '4'">4</button>
        <button onclick="calcInput.value += '5'">5</button>
        <button onclick="calcInput.value += '6'">6</button>
        <button onclick="calcInput.value += '*'">*</button>

        <button onclick="calcInput.value += '1'">1</button>
        <button onclick="calcInput.value += '2'">2</button>
        <button onclick="calcInput.value += '3'">3</button>
        <button onclick="calcInput.value += '-'">-</button>

        <button onclick="calcInput.value += '0'">0</button>
        <button onclick="calcInput.value += '.'">.</button>
        <button onclick="calcEval()">=</button>
        <button onclick="calcInput.value += '+'">+</button>
      </div>
    </div>
  </main>

  <!-- AUTRES PAGES (masquées au chargement) -->
  <main id="production" class="page"></main>
  <main id="arrets" class="page"></main>
  <main id="organisation" class="page"></main>
  <main id="personnel" class="page"></main>

  <!-- FOOTER -->
  <footer>
    <p>© Atelier PPNC — Application interne Lactalis</p>
  </footer>

  <!-- SCRIPT PRINCIPAL -->
  <script src="app.js"></script>
</body>
</html>
